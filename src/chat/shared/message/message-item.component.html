<div *ngIf="(!['notification', 'message_deleted'].includes(message.message_type))" class="message-item" [ngClass]="{'message-item-left': !byMe, 'message-item-right': byMe}">
  <div class="message-item-date" *ngIf="hasShowDate()">
    <span>{{ message.created_at | timeFormat:'day' }}</span>
  </div>
  <div class="message-item-content">
    <div class="message-item-owner" *ngIf="hasShowOwner() && message.user && !(['request', 'request_accepted'].includes(message.message_type))">
      <h4 class="message-item-owner-name">
        <a class="mr5" [routerLink]="[profileUrl, message?.user?.uuid]"> {{ message.user.name }} </a>
        <small class="text-fade">{{ message.created_at | timeFormat: "time_only" }}</small>
      </h4>
      <figure class="message-item-owner-avatar">
        <span class="avatar-xs">
          <img [src]="message.user?.profile_image" alt="">
        </span>
      </figure>
    </div>
    <div class="message-item-content-card" *ngIf="!(['notification', 'request_accepted'].includes(message.message_type))">
      <!--mesasge menu-->
      <div class="message-item-menu dropdown" *ngIf="!(NO_ACTION_MESSAGES?.includes(message?.message_type)) && byMe">
        <i class="fa fa-sort-down" data-toggle="dropdown" pTooltip="{{ tooltip.showActions }}" tooltipPosition="top"></i>
        <!--text message menu actions-->
        <ul class="dropdown-menu dropdown-menu-right" *ngIf="message.message_type == 'text'">
          <li *ngIf="!message.file">
            <a href="javascript:;" (click)="copy()">Copy</a>
          </li>
          <!--comment out this menu because this function is not working now-->
          <li *ngIf="!message.file && byMe">
            <a href="javascript:;" (click)="edit()">Edit</a>
          </li>
          <li *ngIf="!message.file && byMe">
            <a href="javascript:;" (click)="delete()">Delete</a>
          </li>
        </ul>

        <!--photos menu actions-->
        <ul class="dropdown-menu dropdown-menu-right" *ngIf="message.file_type == 'Media::Photo'">
          <li *ngIf="message.file && message.message_type !== 'message_deleted'">
            <a [href]="message.file.url" target="_blank" download>
              Download
            </a>
          </li>
          <li *ngIf="byMe">
            <a href="javascript:;" (click)="delete()">Remove</a>
          </li>
        </ul>
        <!--note menu actions-->
        <ul class="dropdown-menu dropdown-menu-right" *ngIf="message.file_type == 'Note::Note'">
          <li>
            <a [href]="noteUrl + '/notes/public/' + message.uuid" target="_blank">
              Open
            </a>
          </li>
          <li *ngIf="byMe">
            <a href="javascript:;" (click)="delete()">Remove</a>
          </li>
        </ul>

        <!--sending message menu-->
        <ul class="dropdown-menu dropdown-menu-right" *ngIf="message.sending_status == 1">
          <li>
            <a (click)="cancle()" target="_blank" download>
              Cancel
            </a>
          </li>
        </ul>

        <!--other menu -->
        <ul class="dropdown-menu dropdown-menu-right" *ngIf="message.file_type == 'Common::GenericFile'">
          <li *ngIf="message.file && message.message_type !== 'message_deleted' && message.message_type !== 'message_cancel'">
            <a [href]="message.file.url" target="_blank" download>
              Download
            </a>
          </li>
          <li *ngIf="byMe">
            <a href="javascript:;" (click)="delete()">Remove</a>
          </li>
        </ul>
      </div>
      <div class="message-item-content-main">
        <!--text type-->
        <div class="message-item-content-text" *ngIf="message.message_type == 'text'">
          <span [innerHtml]="message.message | wth2Emojis:emojiMap | linkify | safeHtml"></span>
        </div>

        <ng-template [ngIf]="message.message_type == 'file'">

          <!--show sending -->
          <div *ngIf="message.sending_status == 1" class="message-item-content-other-files">
            <a class="media-div link-text" href="javascript:void(0);">
              <div class="pull-left">
                <i class="fa fa-spinner fa-spin fa-fw"></i>
              </div>
              <div class="media-div-body">
                <div class="media-div-heading">{{ message.message }}</div>
              </div>
            </a>
          </div>

          <!--show failed sending -->
          <div *ngIf="message.sending_status == -1" class="message-item-content-other-files">
            <a class="media-div link-text" href="javascript:void(0);">
              <div class="pull-left">
                <i class="fa fa-file-o"></i>
              </div>
              <div class="media-div-body">
                <div class="media-div-heading">Failed sending file</div>
              </div>
            </a>
          </div>

          <!--photo type-->
          <div class="message-item-content-photo" *ngIf="message.file_type == 'Media::Photo'">
            <figure>
              <a href="javascript:void(0);" (click)="onPreviewPhoto(message)">
                <img [src]="message.file?.url" alt="" (load)="onImgLoaded()">
              </a>
            </figure>
          </div>


          <!--video type-->
          <div class="message-item-content-photo can-click" *ngIf="message.file_type == 'Media::Video'">
            <figure>
              <div class="photo-box-figure-in" (click)="onPreviewPhoto(message)">
                <!-- <div class="photo-box-figure-in"> -->
                <img [src]="message.file?.thumbnail_url" alt="">
                <i class="fa fa-play-circle-o"></i>
              </div>
            </figure>
          </div>

          <!-- file type-->
          <div class="message-item-content-other-files" *ngIf="message.file_type == 'Common::GenericFile'">
            <a class="media-div link-text" [href]="message.file?.url" target="_blank" download>
              <div class="pull-left">
                <i class="fa fa-file-o"></i>
              </div>
              <div class="media-div-body">
                <div class="media-div-heading">{{ message.file?.full_name }}</div>
                <div class="text-fade">{{ message.file?.size | bytes:3 }}</div>
              </div>
            </a>
          </div>

          <!-- note type-->
          <div class="message-item-content-note" *ngIf="message.file_type == 'Note::Note'">
            <a class="d-block" [href]="noteUrl + '/notes/public/' + message?.uuid" target="_blank">
              <h5>
                <i class="fa fa-file"></i> {{message.file?.name ? message.file?.name : 'Untitled'}}
              </h5>
              <div class="message-item-content-note-in" [innerHTML]="message.file?.content"></div>
            </a>
          </div>
        </ng-template>



        <!--hyperlink tpe-->
        <div class="message-item-content-hyperlink">

        </div>

        <!--quote message type-->
        <div class="message-item-content-quote-text" *ngIf="message.message_type == 'quote'">
          <!-- <blockquote>
            <strong>David Nguyen</strong>
            <span>4:37 PM</span>
            <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Atque aut cupiditate doloremque, ea esse eveniet illum
              incidunt itaque molestias nisi non quae recusandae, sequi sint sunt suscipit tenetur ullam voluptatibus?
            </p>
          </blockquote> -->
        </div>

        <!--share contact type-->
        <div class="message-item-content-contact-sharing" *ngIf="message.message_type == 'share_contact_message'">
          <!-- Sender -->
          <message-actions-item *ngIf="byMe" [avatar]=message?.display?.share_contact?.profile_image [url]="socialUrl+'/profile/' + message?.display?.share_contact?.uuid"
            [name]=message?.display?.share_contact?.name [status]="" [actions]="[{text: '', id: 'resend', class:'fa fa-comment-o', btnClass:'btn-default'}]"
            (eventOut)=onShareContact($event)>
          </message-actions-item>
          <!-- Receiver -->
          <message-actions-item *ngIf="!byMe" [avatar]=message?.display?.share_contact?.profile_image [url]="socialUrl+'/profile/' + message?.display?.share_contact?.uuid"
            [name]=message?.display?.share_contact?.name [status]="" [actions]="[{text: '', id: 'add_contact', class:'fa fa-comment-o', btnClass:'btn-default'}]"
            (eventOut)=onAdd($event)>
          </message-actions-item>
        </div>


        <!--requested contact type-->
        <div class="message-item-content-contact-sharing" *ngIf="message.message_type == 'request'">
          <!-- sent_request -->
          <message-actions-item *ngIf="byMe" [avatar]=message.receiver?.profile_image [url]="'profile/' + message.receiver.uuid"
            [name]=message.receiver.name [status]="'Requested'" [actions]="[]" (eventOut)=doEvent($event)>
          </message-actions-item>
          <!-- contact already accepted -->
          <message-actions-item *ngIf="byMe && message.status == 'accepted'" [avatar]=message.receiver?.profile_image
            [url]="'profile/' + message?.receiver?.uuid" [name]=message.receiver.name [status]="'accepted your request'"
            (eventOut)=doEvent($event)>
          </message-actions-item>
          <!-- Receiver -->
          <!--<message-simple-item *ngIf="!byMe" [data]="'Hello! You are now connected on Chat.'"></message-simple-item>-->
        </div>

        <!--leave conversation-->
        <div class="message-item-content-conversation-leave">

        </div>

        <!--add new contact-->
        <div class="message-item-content-conversation-add-new-contact">

        </div>

        <!--deleted type-->
        <!-- <div class="message-item-content-text" *ngIf="message.message_type == 'message_deleted'">
          <span>This message has been deleted</span>
        </div> -->

        <!--cancel message type-->
        <div class="message-item-content-text" *ngIf="message.sending_status == 2">
          <span>Canceled sending a file</span>
        </div>
        <!--can't upload message type-->
        <div class="message-item-content-text" *ngIf="message.sending_status == 3">
          <span>{{ message.message }}</span>
        </div>

      </div>

      <!--mesasge menu-->
      <div class="message-item-menu dropdown" *ngIf="!(NO_ACTION_MESSAGES?.includes(message?.message_type)) && byMe">
        <i class="fa fa-sort-down" data-toggle="dropdown" pTooltip="{{ tooltip.showActions }}" tooltipPosition="top"></i>

        <!--text message menu actions-->
        <ul class="dropdown-menu dropdown-menu-right" *ngIf="message.message_type == 'text'">
          <li *ngIf="!message.file">
            <a href="javascript:;" (click)="copy()">Copy</a>
          </li>
          <!--comment out this menu because this function is not working now-->
          <li *ngIf="!message.file && byMe">
            <a href="javascript:;" (click)="edit()">Edit</a>
          </li>
          <li *ngIf="!message.file && byMe">
            <a href="javascript:;" (click)="delete()">Delete</a>
          </li>
        </ul>

        <!--photos menu actions-->
        <ul class="dropdown-menu dropdown-menu-right" *ngIf="['file'].includes(message.message_type) ">
          <li *ngIf="message.file && message.message_type !== 'message_deleted'">
            <a [href]="message.file.url" target="_blank" download>
              Download
            </a>
          </li>
          <li *ngIf="byMe">
            <a href="javascript:;" (click)="delete()">Remove</a>
          </li>
        </ul>
        <!--note menu actions-->
        <ul class="dropdown-menu dropdown-menu-right" *ngIf="message.file_type == 'Note::Note'">
          <li>
            <!-- {{message.src_controls | json}} -->
            <a [href]="noteUrl + '/notes/public/' + message.uuid" target="_blank">
              Open
            </a>
          </li>
          <li *ngIf="byMe">
            <a href="javascript:;" (click)="delete()">Remove</a>
          </li>
        </ul>

        <!--sending message menu-->
        <ul class="dropdown-menu dropdown-menu-right" *ngIf="message.sending_status == 1">
          <li>
            <a (click)="cancel()" target="_blank" download>
              Cancel
            </a>
          </li>
        </ul>
        <ul class="dropdown-menu dropdown-menu-right" *ngIf="message.message_type == 'share_contact_message'">
          <li *ngIf="byMe">
            <a href="javascript:;" (click)="delete()">Remove</a>
          </li>
        </ul>
        <!--other menu -->
        <ul class="dropdown-menu dropdown-menu-right" *ngIf="message.file_type == 'Common::GenericFile'">
          <li *ngIf="message.file && message.message_type !== 'message_deleted' && message.message_type !== 'message_cancel'">
            <a [href]="message.file.url" target="_blank" download>
              Download
            </a>
          </li>
          <li *ngIf="byMe">
            <a href="javascript:;" (click)="delete()">Remove</a>
          </li>
        </ul>

      </div>


      <!--<div class="message-item-action" *ngIf="(message.message_type == 'text' || message.file_type == 'Media::Photo' || message.file_type == 'Common::GenericFile')">-->
      <!--<div class="message-item-time">-->
      <!--<small>{{ message.created_at | timeFormat: "time_only" }}</small>-->
      <!--</div>-->
      <!--</div>-->
      <div class="message-item-status" *ngIf="byMe && message.message_type !== 'message_deleted'">
        <span>Sent
          <i class="fa fa-check-circle-o"></i>
        </span>
      </div>
    </div>
  </div>
</div>

<div *ngIf="message?.links?.length > 0" class="message-item" [ngClass]="{'message-item-left': !byMe, 'message-item-right': byMe}">
  <div class="message-item-content">
    <div class="message-item-content-card" *ngIf="!(['notification', 'request_accepted'].includes(message.message_type))">
      <ng-container *ngFor="let link of message.links">
        <div *ngIf="link.image && link.title" class="message-item-content-main">
          <display-link class="message-item-content-link" [data]="link" *ngIf="link.image && link.title"></display-link>
        </div>
      </ng-container>
    </div>
  </div>
</div>


<div *ngIf="['notification', 'request_accepted'].includes(message.message_type)" class="p20 text-center">
  <div *ngIf="message.message_type === 'notification'">

    <ng-container *ngIf="message.message.indexOf('added into') !== -1">
      <span class="text-bold"> {{ byMe ? 'You' : message.user?.name }} </span> added
      <span class="text-bold">{{ message.receiver?.name }}</span> into this conversation
    </ng-container>

    <ng-container *ngIf="message.message.indexOf('removed from') !== -1">
      <span class="text-bold"> {{ byMe ? 'You' : message.user?.name }} </span> removed
      <span class="text-bold"> {{ message.receiver?.name }}</span> from this conversation
    </ng-container>

    <ng-container *ngIf="(message.message.indexOf('added into') === -1) && (message.message.indexOf('removed from') === -1)">
      <span class="text-bold"> {{ byMe ? 'You' : message.user?.name }} </span> {{ message.message }}
    </ng-container>
  </div>

  <div *ngIf="message.message_type === 'request_accepted'">
    You connected with
    <span class="text-bold"> {{ byMe ? message?.receiver?.name : message.user?.name }}</span> on WTH!Chat
  </div>
  <div class="text-fade">
    <small>{{ message.created_at | timeFormat: "time_only" }}</small>
  </div>
</div>

<!--<div *ngIf="['member_added', 'member_removed'].includes(message.message_type)" class="p20 text-center">-->
<!--<div *ngIf="byMe">-->

<!--<ng-container *ngIf="message.message.indexOf('added into') !== -1">-->
<!--<span class="text-bold">You</span> added-->
<!--<span class="text-bold">{{ message.receiver?.name }}</span> into conversation-->
<!--</ng-container>-->

<!--<ng-container *ngIf="message.message.indexOf('removed from') !== -1">-->
<!--<span class="text-bold">You</span> removed-->
<!--<span class="text-bold"> {{ message.receiver?.name }}</span> from conversation-->
<!--</ng-container>-->

<!--<ng-container *ngIf="(message.message.indexOf('added into') === -1) && message.message.indexOf('removed from') === -1">-->
<!--<span class="text-bold">You</span> {{ message.message }}-->
<!--</ng-container>-->
<!--</div>-->

<!--<div *ngIf="!byMe">-->
<!--<ng-container *ngIf="[message.message].includes('added into')">-->
<!--<span class="text-bold"> {{ message.user?.name }} added {{ message.receiver?.name }}</span> into conversation-->
<!--</ng-container>-->

<!--<ng-container *ngIf="[message.message].includes('removed from')">-->
<!--<span class="text-bold"> {{ message.user?.name }} removed {{ message.receiver?.name }}</span> from conversation-->
<!--</ng-container>-->

<!--<ng-container *ngIf="![message.message].includes('added into') && ![message.message].includes('removed from')">-->
<!--<span class="text-bold"> {{ message.user?.name }}</span> {{ message.message }}-->
<!--</ng-container>-->

<!--</div>-->

<!---->
<!--</div>-->
